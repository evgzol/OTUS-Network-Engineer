!
version 15.4
service timestamps debug datetime msec
service timestamps log datetime msec
no service password-encryption
!
hostname R15
!
boot-start-marker
boot-end-marker
!
!
!
no aaa new-model
mmi polling-interval 60
no mmi auto-configure
no mmi pvc
mmi snmp-timeout 180
!
!
!
!
!
!
!
!


!
!
!
!
ip domain name otus.ru
ip host R12 77.77.77.12
ip cef
no ipv6 cef
!
multilink bundle-name authenticated
!
!
!
!
!
!
!
crypto pki trustpoint R12
 enrollment url http://77.77.77.12:80
 serial-number
 revocation-check crl
!
!
crypto pki certificate chain R12
 certificate 02
  30820305 308201ED A0030201 02020102 300D0609 2A864886 F70D0101 05050030
  0E310C30 0A060355 04031303 52313230 1E170D32 35303832 35303634 3332335A
  170D3236 30383235 30363433 32335A30 2D312B30 0F060355 04051308 36373130
  39313034 30180609 2A864886 F70D0109 02160B52 31352E6F 7475732E 72753082
  0122300D 06092A86 4886F70D 01010105 00038201 0F003082 010A0282 010100A8
  99D2AF30 9AA21258 ED2B667C 7053F387 E27FEAA7 CFE03492 8C98A7BA D14A1D32
  C855149B 229FFD01 0F121B8E 83DC33A4 C205D65C B68EEEA4 F0E84C54 7CF9F51A
  D1978A06 0DF90111 6B1415A1 6A3C66C9 D9BAC117 1F04479B DDACA821 C76ECE53
  C812DE0B 31DC9A6C 5232A23F 5786A0E2 4070F5A0 DDCD72E9 1A9D3610 2A71819D
  D2958B0D C3C1EC16 CB818DBB 3F2F1C6A 56454BE3 22394DD4 22A1605E F688286E
  90B6AC60 D3C5979F A97A1E04 F6560100 C2FDC126 F9C28DAD 3F6A7031 97F09D41
  12E26949 0160EDAB 7002AF00 8E05141E C7DD8FA7 8E8EC97C 3510D22D 6C31AD19
  11425BE2 3C00E3C2 38F54339 166B8C33 95A2A03E 95478C34 9C67E377 7FE06702
  03010001 A34F304D 300B0603 551D0F04 04030205 A0301F06 03551D23 04183016
  80142C1E 1D2C7223 5B410FAA D616FDC9 CB2449A4 ECEB301D 0603551D 0E041604
  1445CF51 1119675E 4926B037 741C4C9F CCD76A37 C1300D06 092A8648 86F70D01
  01050500 03820101 003DC4BE D59F0722 C5F1FADE F72A8662 BE108693 45BD18AD
  8E7A4381 401148D5 EB6B7264 6575B255 C95247B6 3C43CE4B BAAE77A0 E22CE6EB
  559022C1 2EB89940 51A85979 5A5D9A23 B51E51D5 219F5083 294D2ACB C07C7FDA
  AACDE216 DD3687CD 3D224EDF E639B659 224C03D9 60504C8B C62D5E11 FD3BB776
  CDA7E80B 29250C07 FD267981 6929A037 88A85EF6 0A5266B7 64FB47EE D2336C7A
  203D9CCC 1BA7EA8D 0461266E 5B4091B8 28A2F501 3FB5329C 0AE18343 B3F06F8C
  9F63C14A DCF398D1 A1F3A4A1 803F8434 4DA7DBC2 127C61DE E41B7C20 727E7C2C
  969840CC 81DA7274 3B035616 30A8A0DC D2C29933 DD94949C 2C7B8E98 513444BC
  FF105F99 B26CCDB4 7B
        quit
 certificate ca 01
  308202FA 308201E2 A0030201 02020101 300D0609 2A864886 F70D0101 04050030
  0E310C30 0A060355 04031303 52313230 1E170D32 35303832 35303532 3931385A
  170D3238 30383234 30353239 31385A30 0E310C30 0A060355 04031303 52313230
  82012230 0D06092A 864886F7 0D010101 05000382 010F0030 82010A02 82010100
  85003091 86363F48 000A6E6A A0941BEE 3EC7D5E3 E09915D8 BC657ADF 7D67E242
  51136257 59503AAD D8E33AB4 6DB3E72C B8140A52 370780CB 1028CAA3 6AE81892
  D8EF1CDD 2B96B56C 52BEFD00 C90E8399 39A83080 93299D69 91AF0C8A 36889518
  761AFC06 EB7B5CB7 FD88D2E3 7DDB592F 28CE03B4 5C372EA7 4EF04683 986BA403
  69869366 A3BA0AB0 1B122730 8683D87D 1445B7E8 ABD4A989 DBB101BA A05861C9
  3C01C463 D6F2A729 345FE5F8 E8D6AA2C CE95D74E 98638808 41F107AD EB848037
  088E499E DB5E519D 4DB084E9 4CB0D9A9 189576AC 2AA6DF2F A3725447 2B4E1A15
  ADD16803 713B3F35 83DAF6D4 6B385097 3F58EE5C F6C5E2F3 D583DF09 7491BE0F
  02030100 01A36330 61300F06 03551D13 0101FF04 05300301 01FF300E 0603551D
  0F0101FF 04040302 0186301F 0603551D 23041830 1680142C 1E1D2C72 235B410F
  AAD616FD C9CB2449 A4ECEB30 1D060355 1D0E0416 04142C1E 1D2C7223 5B410FAA
  D616FDC9 CB2449A4 ECEB300D 06092A86 4886F70D 01010405 00038201 01005B0F
  6098C6E3 5009FC6B 469D9CA4 DCB200C9 35CF1E25 9B980A5B 3E9EE3A8 09959B9E
  963D0731 961EE82A D9ECCEF4 B31F9014 11DFA35A 3E0DC1DE A335FC09 795F09D7
  2B3373B9 8024624F 4C0BA9F6 FF704A56 64303540 1F862533 B4C7F0A6 B8B837D4
  32769F8C 3F8DCDFC E6555E30 E739BA93 0C28FDE6 08B3286F 8A8535DD FF0A6C20
  96A46344 0AED8636 77D32CEE 9B2687B5 808FAFD0 27AEBD18 E9C15C09 C7A1DFA2
  86875326 BAA130BA 74E9B2A8 384881A1 EC108A01 7AED5E81 9B8808A1 263B8C65
  96C4A601 C99E80D9 B3F8034D D0166257 981468F0 FC40A847 DCFE6012 CEBB706E
  BCE01685 CE407C69 056115E9 8C8AC61C 605BB41B 529A816C 2323F948 C1FD
        quit
!
redundancy
!
!
!
!
!
!
!
crypto isakmp policy 1
 encr aes 192
 hash sha256
 group 5
!
!
crypto ipsec transform-set IPSEC esp-aes esp-sha-hmac
 mode transport
!
crypto ipsec profile LAB14
 set transform-set IPSEC
!
!
!
!
!
!
!

interface Loopback0
 ip address 10.77.0.15 255.255.255.255
 ip ospf 1 area 0
!
interface Loopback1
 ip address 77.77.77.15 255.255.255.255
!
interface Loopback100
 description *** for GRE ***
 ip address 77.77.77.115 255.255.255.255
!
interface Loopback200
 description *** for DmVPN ***
 ip address 77.77.77.215 255.255.255.255
!
interface Tunnel0
 ip address 10.100.15.15 255.255.255.0
 tunnel source 77.77.77.115
 tunnel destination 78.78.78.18
 tunnel protection ipsec profile LAB14
!
interface Tunnel1
 ip address 10.200.15.15 255.255.255.0
 no ip redirects
 ip nhrp map multicast dynamic
 ip nhrp network-id 1500
 tunnel source 77.77.77.215
 tunnel mode gre multipoint
 tunnel key 1500
 tunnel protection ipsec profile LAB14
!
interface Ethernet0/0
 description *** to R13 (e0/2)
 ip address 10.77.1.17 255.255.255.252
 ip nat inside
 ip virtual-reassembly in
 ip ospf 1 area 10
!
interface Ethernet0/1
 description *** to R12 (e0/3)
 ip address 10.77.1.13 255.255.255.252
 ip nat inside
 ip virtual-reassembly in
 ip ospf 1 area 10
!
interface Ethernet0/2
 description *** to R21 (e0/0) Lamas
 ip address 131.131.131.2 255.255.255.252
 ip nat outside
 ip virtual-reassembly in
!
interface Ethernet0/3
 description *** to R19 (e0/0)
 ip address 10.77.1.21 255.255.255.252
 ip nat inside
 ip virtual-reassembly in
 ip ospf 1 area 102
!
interface Ethernet1/0
 description *** to R14 (e1/0)
 ip address 77.77.77.2 255.255.255.252
 ip nat outside
 ip virtual-reassembly in
 ip ospf 1 area 0
!
interface Ethernet1/1
 no ip address
 shutdown
!
interface Ethernet1/2
 no ip address
 shutdown
!
interface Ethernet1/3
 no ip address
 shutdown
!
router ospf 1
 router-id 15.15.15.15
 area 102 filter-list prefix WITHOUT_Area101 in
 network 10.77.0.15 0.0.0.0 area 0
 default-information originate
!
router bgp 1001
 bgp log-neighbor-changes
 network 77.77.77.0 mask 255.255.255.0
 redistribute connected route-map FILTER
 neighbor 10.77.0.14 remote-as 1001
 neighbor 10.77.0.14 update-source Loopback0
 neighbor 10.77.0.14 next-hop-self
 neighbor 131.131.131.1 remote-as 301
 neighbor 131.131.131.1 prefix-list MSK_SUM out
 neighbor 131.131.131.1 route-map LAMAS in
 neighbor 131.131.131.1 filter-list 1 out
!
ip forward-protocol nd
!
ip as-path access-list 1 permit ^$
!
no ip http server
no ip http secure-server
ip nat pool MSK_NAT 77.77.77.15 77.77.77.15 netmask 255.255.255.0
ip nat inside source list MSK_CLIENT pool MSK_NAT overload
ip nat inside source static 10.77.0.20 77.77.77.15
ip route 77.77.77.0 255.255.255.0 Null0 210
!
ip access-list extended MSK_CLIENT
 permit ip 10.77.10.0 0.0.0.255 any
 permit ip 10.77.20.0 0.0.0.255 any
!
!
ip prefix-list FILTER seq 5 deny 10.0.0.0/8 le 32
ip prefix-list FILTER seq 10 permit 0.0.0.0/0 le 32
!
ip prefix-list MSK_SUM seq 10 permit 0.0.0.0/0 le 24
!
ip prefix-list WITHOUT_Area101 seq 5 deny 10.77.0.19/32
ip prefix-list WITHOUT_Area101 seq 10 deny 10.77.1.0/30 le 32
ip prefix-list WITHOUT_Area101 seq 15 permit 0.0.0.0/0 le 32
!
route-map FILTER permit 10
 match ip address prefix-list FILTER
!
route-map LAMAS permit 10
 set local-preference 200
!
!
!
control-plane
!
!
!
!
!
!
!
!
line con 0
 logging synchronous
line aux 0
line vty 0 4
 login
 transport input none
!
ntp master 2
ntp update-calendar
!
end
